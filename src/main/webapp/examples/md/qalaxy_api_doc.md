**星河地产开放服务接口规范说明书**
-----------
### 变更记录
|  版本号 |    修改原因/内容 | 修改人  | 修改时间  |
| ------- | ------------- : | -----: | -----: |
|  V1.0  | 初稿                  |  余世明   |2016/03/16|
|  V1.1  | 修改接口分类、接口编号、格式调整                      |  余世明   |2016/03/23|
|  V1.2  | 经项目经理确认，经纪人平台取消预约功能。故废弃 4.4.3. P-FR-09客户预约上报(sale\_appoint)接口 | 周　亮 | 2016/05/15 |
|:star:V1.3 |[客户推荐上报](#4.4.1. P-FR-01客户推荐上报（agent_recommend）)enable字段调整为：<font color="red">只支持有效客户推荐</font> | 周　亮 | 2016/07/11 |

[TOC]

#1. 前言
本接口规范，是地产数据中心系统，数据应用的开放服务接口协议定义。适用于包括但不限于经纪人平台、案场APP、微信案场等，接入数据中心所遵循的标准。

#2. 总体规范
##2.1. 接口规范
*       接口采用`HTTP+JSON`，所有接口调用，均遵守`HTTP`协议，支持`GET`与`POST`两种方式，拒绝其它请求方式；统一使用UTF-8编码；包括消息内字段，及所有值。
*       所有上下行消息中，HTTP协议头部分必须包含`Content-Length`和`Content-Type`两个字段，`contnet-length`即`http`协议`body`长度；`content-type`值固定为`application/js
on`；
*       所有返回消息或参数，均以文本格式进行返回，对于二进制数据，则通过其它模块，以资源管理形式进行库维护。
*       所有请求中，必须包含认证必须字段，否则视为无效请求，予以拒绝。
*       所有时间字段，均以年月日时分秒的长字符串表示，格式为:*YYYY-MM-dd HH:mm&#58;ss*
*       所有上行消息的`JSON`，必须包含`header`和`data`两部分。`header`包含接口调用参数，即非业务相关数据；`data`部分为实际的业务数据；`data`为结构化的`json`转成字符串
后，根据数据中心分配`appkey`加密后的`base64`字符串，加密算法为`RC4`。格式示例：
```json
                {
                        "header":{},
                        "data":""
                }
```
+ `header`必须包含的信息有

| 字段      |   说明  |
| :-------- | :--------| 
|appid  |       数据中心分配给应用的标识|
|timestamp      |时间戳，UTC秒值
|sid            |消息ID，查看2.4章节SID定义
|authCode       |认证校验码，即按自然排序后字符串拼接组合`appid`、`sid`、`token`、` dataCode`计算出的`sha1`散列码；其中`token`是数据中心分配给应用的校验码
|cmd    |调用命令，即接口名称，查看第4章节开放接口标题括号中定义
|version        |版本
|dataCode       |数据校验码，即结构化的`json`转成字符串后使用`appkey`加密后的数据，经`Base64`加密后计算出的`sha1`散列码。其中`appkey`是数据中心分配给应用的秘钥

*       所有响应消息的JSON，`data`部分加密的密钥与算法同上行消息。格式示例：
``` json
{
        "header":{},
        "data":""
}
```
+ `header`必须包含的信息有

| 字段      |   说明  |
| :-------- | :--------|
|appid  |       数据中心分配给应用的标识|
|timestamp      |时间戳，UTC秒值
|sid            |消息ID，查看2.4章节SID定义
|authCode       |认证校验码，即按自然排序后字符串拼接组合`appid`、`sid`、`token`、` dataCode`计算出的`sha1`散列码；其中`token`是数据中心分配给应用的校验码
|cmd    |调用命令，即接口名称，查看第4章节开放接口标题括号中定义
|version        |版本
|dataCode       |数据校验码，即结构化的`json`转成字符串后使用`appkey`加密后的数据，经`Base64`加密后计算出的`sha1`散列码。其中`appkey`是数据中心分配给应用的秘钥

*       所有响应消息的JSON，`data`部分加密的密钥与算法同上行消息。格式示例：
``` json
{
        "header":{},
        "data":""
}
```
其中data部分的原文格式为：
``` json
        {
                "errcode":0,
                "errmsg":"",
                "content":{}
        }
```
* 所有响应消息中，除`errcode`和`errmsg`外，所有必须参数，均指在`errcode`为0(即成功)的情况下才是必须

##2.2. 系统编号（appid）

| 系统分类      |appid编号      |说明|
| :--------     | :---------- | :-------- |
|数据中心               |1XX    |所有数据中心模块或子系统`appid`取值范围为100~199|
|经纪人平台     |2XX    |经纪人类平台系统，如带客通、同享会等`appid`取值范围为200~299|
|案场系统       |3XX    |包括案场、微信等案场类系统`appid`取值为300~399|
|ERP系统        |4XX    |指现有传统ERP系统，如明源、用友等`appid`取值范围为400~499|
|会员类 |5XX    |包括统一会员平台或各业态的独有会员系统`appid`的取值范围500~599|
|电商类 |6XX    |包括第三方或自有渠道应用，如京东、官微等`appid`的取值范围为600~699|

##2.3. 接口编号规则
接口名定义分3部分，示例：`P1-P2-P3`

-       `P1`：表示接口接口处理方式。目前取值分别是
P:上报类接口
      G:查询类接口
      N:通知类接口
-       `P2`：表示数据用途分类。目前取值分别是
        BA：基础数据类接口
   US：用户类接口
        CU：客户类接口
   FR：跟进类接口
-       `P3`：表示在数据用途类范围内的接口编号

##2.4. SID定义
对应`head`包中的 `sid`定义：
数据中心与应用系统传输的每一条接口命令都有一个序列号，序列号由命令源系统产生并唯一标记一条命令；也就是说，数据中心系统中任何两个命令的序列号都不相同。对于数据中心主动>推送到业务应用（经纪人平台、案场管理等）的消息，例如数据中心向案场发送一条推荐客户信息，此时序列号由数据中心生成（此时命令源节点为数据中心）。
序列号分成三部分，每部分为一个整数，第一部分表示命令源系统的编号，第二部分表示命令产生的日期和时间，格式为十进制的*yymmddhhmm*，比如14年11月20日20时32分25秒产生的消息>，其第二部分为十进制*141120203225*；第三部分由0开始，最大值是99999，循环进位，直到进位满了之后再清零，重新开始计数, 不够5位，左补0

#3. 接入认证
上下行接入认证，采用同样算法；数据取值不同；应用上行到数据中心的，采用数据中心分配给应用的`appid`和`appkey`进行解析认证；数据中心下行到应用的，采用数据中心的`appid`和>数据中心分配给应用`appkey`进行解析认证

##3.1. 请求步骤封装
1. 首先根据`SID`生成规则，生成消息ID
2. 将业务数据转成结构化的JSON转成字符串后，用数据中心分配的appkey进行`RC4`加密，密文经`base64`加密后`sha1`，即`dataCode`
3. 把密文进行`base64`加密；作为`data`字段值
4. 把`appid`、`sid`、数据中心分配的`token`、`dataCode`按自然排序后字符串拼接组装后计算`sha1`,即`authCode`
5. 创建`header`，包括字段`appid`、`sid`、`token`、`authCode`、`cmd`、`timestamp`、`version`、`dataCode`
6. 示例：

``` java
//初始化数据：
appid = "123";
token = "52e41ab0d3eee56b725e3e29999762a8";
appkey = "S_+SFO!fH.7qj_CEIKgCoSRfYr&e%,zAL1-*UEW7D]V$o4Cc=Dd4kwSh%6Q<!?=!+_@H^,K*#Gdk/d.qp@nBjl:e^/,.ckVGC2<4OoZNS2JN5<IX[Uq0W0oI-Y(K[k-R";
sid = "2014123123123123";
data = "{\"hello\":123}";
cmd = "cst_identity";
```
> **1.**根据`data`计算原始字节码：

``` 7B 22 68 65 6C 6C 6F 22 3A 31 32 33 7D ```

> **2.**根据原始字节码计算密文：

``` 15 0C FC 96 18 A1 15 B0 47 F1 F5 78 3C ```

> **3.**根据密文计算`base64`：

``` FQz8lhihFbBH8fV4PA== ```

> **4.**根据`base64`计算`sha1`散列码，即`dataCode`：

``` a975283943d4be0d7cb355c2115f45d63b5dcc5d ```

> **5.**将`appid`、`sid`、`token`、`dataCode`组合起来：

``` 123201412312312312352e41ab0d3eee56b725e3e29999762a8a975283943d4be0d7cb355c2115f45d63b5dcc5d ```

> **6.**计算其`sha1`散列码，即`authCode`：

``` 8c694932bba5d137af13654ce5a875d30a267ec8 ```

> **7.**计算结果：

``` json
{
    "header": {
        "timestamp": 1436782123,
        "dataCode": "a975283943d4be0d7cb355c2115f45d63b5dcc5d",
        "authCode": "8c694932bba5d137af13654ce5a875d30a267ec8",
        "sid": "2014123123123123",
        "cmd": "cst_identity",
        "appid": "123",
        "version": "2.0"
    },
    "data": "FQz8lhihFbBH8fV4PA=="
}
```
##3.2. 接收验证步骤
1. 首先根据`http`头部的`content-length`读取报文后，解析成JSON；
2. 取header中的`appid`、`sid`、数据中心分配的`token`、`dataCode`，按自然排序后字符串拼接组装后计算`sha1`，与`authCode`比较判断接入认证
3. 接入认证成功后，以`base64`解密算法，将`data`值还原成密文；
4. 计算密文的`sha1`散列码，比较`dataCode`校验是否被篡改；
5. 篡改校验通过后，再用数据中心分配的`appkey`为密钥，以`RC4`算法解密转成结构化的JSON字符串
6. 示例：
``` json
//接收报文：
{
    "header": {
        "timestamp": 1436782123,
        "dataCode": "a975283943d4be0d7cb355c2115f45d63b5dcc5d",
        "authCode": "8c694932bba5d137af13654ce5a875d30a267ec8",
        "sid": "2014123123123123",
        "appid": "123",
        "version": "2.0"
    },
    "data": "FQz8lhihFbBH8fV4PA=="
}
```

> **1.**拼接`appid`、`sid`、`token`、`dataCode`：

``` 123201412312312312352e41ab0d3eee56b725e3e29999762a8a975283943d4be0d7cb355c2115f45d63b5dcc5d ```

> **2.**计算拼接后字符串的`sha1`散列码：

``` 8c694932bba5d137af13654ce5a875d30a267ec8 ```

> **3.**计算`data`的`sha1`散列码：

``` a975283943d4be0d7cb355c2115f45d63b5dcc5d ```

> **4.** 经过以上三步计算，验证通过，则进行以下5､6两步：

> **5.** 以`base64`还原`data`为密文

``` 15 0C FC 96 18 A1 15 B0 47 F1 F5 78 3C ```

> **6.**以`appKey`解密密文（如果是数据中心，`appKey`是以`appid`查找在数据中心配置的`appKey`，如果找不到，则不给任何响应数据；若是接入应用，则为数据中心分配的固定`appKey`）：

```7B 22 68 65 6C 6C 6F 22 3A 31 32 33 7D```

#4. 开放接口
##4.1. 基础数据类接口
###4.1.1.       G-BA-01置业顾问查询（user_query）
+ **接口说明**
    查询某代理公司或项目下的所有置业顾问；项目和公司都不是必须参数，如果只传项目，则按项目查询；如果只传公司，则按公司查询；如果都传，则查询项目下某公司的置业顾问；都不传则为非法查询。

> 未推盘的房产不返回

+ **请求参数说明**

| 参数  |必须   |类型|长度|说明|
| :-------- | :--------|:--------|:--------|:--|
|projGUID|否,teamGUID不存在时必须|string|64|项目编号|
|teamGUID|否，projGUID不存在时必须|string|40|销售团队编号|

>***备注：projGUID、teamGUID至少存在一个，否则请求无效***

+ **响应参数说明**

| 参数  |必须   |类型|长度|说明|
| :-------- | :--------|:--------|:--------|:--|
|list|记录存在时必须|jsonArray|N/A|记录列表|
|list/userGUID|是|string|64|用户GUID|
|list/userName|是|string|64|用户名称|
|list/teamGUID|是|string|64|团队编号|
|list/projGUID|是|string|64|所属项目|
|list/attachCode|是|string|64|角色|
|list/status|是|int|64|状态:<br>0=无效<br>1=有效<br>2=离职|
|list/statusReason|是|string|64|状态原因|
|list/mobile|是|string|64|手机号码|
|list/gender|是|int     |4|性别：0=未知，1=男，2=女|

### 4.1.2. G-BA-02代理公司查询（org\_list）

-   **接口说明**

    组织查询。

-   **请求说明**

| 参数     | 是否必须 | 类型 | 长度 | 说明                             |
|----------|----------|------|------|----------------------------------|
| page     | 否       | int  | 10   | 页码                             |
| pageSize | 否       | int  | 10   | 分页大小，取值范围是［10，1000］ |
| orgType  | 否       | int  | 10   | 组织类型<br/>1=代理公司<br/>2=中介公司<br/>3=区域公司/事业部<br/>4=商场<br/>5=商铺<br/>6=门店|
| subType  | 否       | int  | 10   | 子类型<br/>orgType=3 时有效，默认为0<br/>0 无效<br/>1 集团<br/>2 区域公司<br/>3 地市公司<br/>4 部门<br/>5 业态公司|

-   **响应说明**

| 参数               | 是否必须       | 类型       | 长度 | 说明              |
|--------------------|----------------|------------|------|-------------------|
| totalPage          | 是             | int        |      | 记录总页数        |
| page               | 是             | int        |      | 本次查询页码      |
| list               | 记录存在时必须 | array      |      | 记录列表          |
| list/orgGUID       | 是             | string     | 64   | 公司GUID          |
| list/orgName       | 是             | string     | 64   | 公司名称          |
| list/status        | 否        | string | 64   | 状态              |
| list/cityCode      | 是             | int        | 10   | 城市代码          |
| list/cityShortCode | 是      | int    | 10   | 城市短代码        |
| list/parentOrgCode | 否        | string | 64   | 上级组织ID        |
| list/orgFullCode   | 否         | string | 100  | 组织长编码        |
| list/orgType       | 是             | int        | 10   | 组织类型<br/>1=代理公司<br/>3=区域公司/事业部<br/>4=商场<br/>5=商铺<br/>6=门店|

### 4.1.3. G-BA-03城市查询（city\_list）

-   **接口说明**

    城市信息、支持分页查询

-   **请求说明**

| 参数     | 是否必须 | 类型 | 长度 | 说明                                           |
|----------|----------|------|------|------------------------------------------------|
| page     | 否       | int  | 4    | 页码，不填默认为1                              |
| pageSize | 否       | int  | 4    | 分页大小，取值范围是［10，1000］，不填默认为10 |

-   **响应说明**

| 参数          | 是否必须       | 类型      | 说明         |
|---------------|----------------|-----------|--------------|
| totalPage     | 是             | int       | 记录总页数   |
| page          | 是             | int       | 本次查询页码 |
| list          | 记录存在时必须 | jsonArray | 记录列表     |
| list/cityCode | 是             | string    | 城市编号     |
| list/cityName | 是             | string    | 城市名称     |

### 4.1.4. P-BA-04中介代理上报(org\_create)

-   **接口说明**

    应用新增或编辑机构，上报数据中心

-   **请求说明**

| 参数     | 必须   | 类型  | 说明                  |
|---------|--------|---------|---------------------|
| **orgGUID**   | 否 | string   | 组织机构标识，如果带上表示更新 |
| orgName    | 是  | string | 公司名称  |
| orgType  | 是   | Int   | 组织类型：<br/>1=代理公司<br/>2=中介公司|
|contact|是|String| 联系人|
| tel| 是  |String | 联系电话   |
| status     |是   | int  | 状态 1有效,0无效  |
| parentGUID | 否 | string | 上级组织    |
| cityCode | 是  | String  | 城市编码       |

-   **响应说明**

| 参数        | 必须 | 类型   | 说明         |
|-------------|------|--------|--------------|
| orgGUID | 否   | string | 组织机构标识 |

### 4.1.5. G-BA-05项目查询(marketProj_list)

-   **接口说明**

    项目查询，调用项目查询接口

-   **请求说明**

| 参数            | 必须   | 类型       | 长度   | 说明                                |
|-----------------|--------|------------|--------|-------------------------------------|
| articleType | 否 | int    | 10 | 类型：不传时默认全部<br/>1 项目<br/>2 商场|
| articleGUID | 否 | string | 64 | 项目编号|
| page   | 否 | int    | 10 | page，默认1                     |
| pageSize    | 否 | int    | 10 | 分页大小，取值范围是［10，1000 \] pageSize，默认100|

-   **响应说明**

| 参数             | 必须   | 类型          | 长度    | 说明     |
|-----------------|-------|-----------|---------|----------------|
| totalPage     | 是 | int      | 10  | 记录总页数      |
| page       | 是 | string    | 10  | 本次查询页码    |
| list                | 是 | jsonArray | N/A | 结果集      |
| list/articleGUID    | 是 | string    | 64  | 项目ID       |
| list/articleName    | 是 | string    | 64  | 项目名称 |
| list/parentGUID     |是 | string    | 64  | 父级项目ID|
| list/cityCode       | 是 | string    | 64 | 城市编码     |
| list/status         | 是 | int       | 4 | 状态：1有效0无效 |
| list/lastModifyTime | 是 | datetime  | 32  | 最后修改时间,格式*yyyy-MM-dd HH:mm&#58;ss* |
| list/ifEnd      | 是 | int       | 4   | 是否最末级项目：<br/>0 否<br/>1 是 |
| list/buGUID       | 是 | string    | 64  | 项目所属公司编码  |
| list/level      | 是 | int       | 4   | 级别 |
| list/articleType   | 是 | int       | 4   | 项目类型：<br/>1 项目<br/>2 商场|


###4.1.6. G-BA-06销售团队信息查询（team_list）
+ **接口说明**
 查询销售团队信息，支持分页查询。

+ **请求参数说明**

| 参数	|必须	|类型|长度|说明|
| :-------- | :--------|:--------|:--------|:--|
|page|是|int|4|页码|
|pageSize|是|int|4|分页大小，取值范围是［10，1000］|
|projGUID|是|string|64|项目编号|
|orgGUID|否|string|64|代理公司编号|

+ **响应参数说明**

| 参数	|必须	|类型|长度|说明|
| :-------- | :--------|:--------|:--------|:--|
|totalPage|是|int|10|记录总页数|
|page|是|int|10|本次查询页码|
|list|是|jsonArray|N/A|记录列表|
|list/teamGUID|是|string|64|团队编号|
|list/teamName|是|string|64|团队名称|
|list/orgGUID|是|string|64|公司编号|


## 4.2. 用户类接口

### 4.2.1. G-US-01经纪人鉴定（agent\_identify）

-   **接口说明**

    同享会中经纪人注册时向数据中心获取信息经纪人的身份信息，鉴定经纪人是否为业主、员工、会员。

-   **请求说明**

| 参数   | 是否必须 | 类型   | 长度 | 说明       |
|--------|----------|--------|------|------------|
| mobile | 是       | string | 16   | 手机号码   |
| cardId | 否       | string | 18   | 身份证号码 |

-   **响应说明**

| 参数      | 是否必须 | 类型      | 说明                                                 |
|-----------|----------|-----------|------------------------------------------------------|
| identitys | 是       | jsonArray | 身份列表，如业主、会员等<br/>20101 曾经业主<br/>20102 当前业主<br/>20103 租客<br/>20201 会员<br/>20301 经纪人<br/>20302 置业顾问<br/>20401 员工<br/>20402 房产员工<br/>20501 供应商<br/>20502 企业客户|

### 4.2.2. P-US-02经纪人新增（agent\_create）

-   **接口说明**

    同享会中经纪人注册成功时将经纪人信息上报到数据中心。

-   **请求说明** 

| 参数            | 是否必须 | 类型           | 长度   | 说明                       |
|-----------------|----------|----------------|--------|----------------------------|
| name            | 是       | String         | 15     | 经纪人姓名                 |
| mobile          | 是       | String         | 16     | 手机号码                   |
| areaCode        | 是       | int            |        | 所在城市ID                 |
| agentClasses    | 是       | Int            |        | 经纪人类别<br/> 合作方 = 1,<br/>中介公司 = 2,<br/>业主 = 3,<br/>非房产员工 = 4,<br/>外部代理公司 = 5,<br/>独立经纪人 = 6,<br/>企业用户 = 7,<br/>无佣金经纪人 = 8|
| proxyCompanyId  | 否       | string         | 64     | 所在代理公司               |
| agencyCompanyId | 否       | string         | 64     | 所在中介公司               |
| totalPoint      | 否       | int            | 10     | 可用积分，暂不支持         |
| point           | 否   | int        | 10 | 所在中介公司：<br/>1 经纪人等级（普通经纪人)<br/>2 铜牌经纪人<br/> 3 银牌经纪人<br/>4 金牌经纪人<br/>5 钻石经纪人<br/>暂不支持，无值忽略        |
| level           | 否       | string         | 10     | 中介公司经纪人：所在门店<br/>员工：所在部门<br/>业主：所在物业|
| comment         | 否   | String(50) | 50 | 中介公司经纪人：所在门店<br/>员工：所在部门<br/>业主：所在物业|
| status          | 否       | int            | 4      | 状态：<br/>1 有效<br/>0 无效|

-   **响应说明** 

| 参数      | 是否必须 | 类型   | 长度 | 说明       |
|-----------|----------|--------|------|------------|
| agentGUID | 是       | string | 64   | 经纪人GUID |

### 4.2.3. P-US-03经纪人更新（agent\_update）

-   **接口说明**

    同享会将经纪人的更新信息（包括个人资料和积分信息）上报到数据中心

-   **请求说明** 

| 参数            | 是否必须 | 类型       | 长度   | 说明                     |
|-----------------|----------|------------|--------|--------------------------|
| agentGUID       | 是   | string | 20 | 经纪人ID             |
| name            | 是       | string     | 15     | 姓名                     |
| mobile          | 否   | string | 16 | 手机号码             |
| areaCode        | 是       | int        | 10     | 所在城市ID               |
| agentClasses    | 否  | int    | 4  | 经纪人类别：<br/>1 合作方<br/>2 中介公司<br/>3 业主<br/>4 非房产员工<br/>5 外部代理公司<br/>6 独立经纪人<br/>7 企业用户<br/>8 无佣金经纪人|
| proxyCompanyId  | 否       | string     | 64     | 代理公司ID               |
| agencyCompanyId | 否   | string | 64 | 中介公司ID           |
| comment         | 否       | String(50) | 100    | 中介公司经纪人：所在门店<br/>员工：所在部门<br/>业主：所在物业|
| status          | 否       | int            | 4      | 状态：<br/>1 有效<br/>0 无效|

-   **响应说明** 

| 参数      | 是否必须 | 类型   | 说明       |
|-----------|----------|--------|------------|
| agentGUID | 是       | string | 经纪人GUID |

## 4.3. 客户类接口

### 4.3.1. G-CU-01客户查询鉴定（cst\_identify）

-   **接口说明**

1. 根据手机、身份证查询数据中心主档客户（数据服务接口：cst_get_info），如果不存在，直接返回应答：exist=0、身份列表和跟进列表为空； 
2. 查询该客户身份列表（数据服务接口：cst_get_identity）； 
3. 如果存在，调用服务接口查数据中心该客户的跟进列表（该项目及其子项目，接口循环调用后组合结果集）（数据服务接口：cst_get_follow_list）； 
4. 如果跟进列表不为空，且最近一条跟进是当天跟进，直接返回应答：exist=1、身份列表和数据中心跟进列表； 
5. 如果跟进信息不满足3，则查明源当天的跟进（包括认购、认筹、签约），注意：如果此时根据主档在数据中心没找到明源GUID（该项目及其子项目）， 
则会根据电话号码、证件号、项目列表（该项目及其子项目）直接查询明源库；（详细查询语句，咨询开发人员提供） 
6. 将查询到的数据中心跟进和明源跟进记录合并，返回应答：exist：1、身份列表和合并后的跟进列表； 

-   **请求说明** 

| 参数     | 必须 | 类型   | 长度 | 说明                       |
|----------|------|--------|------|----------------------------|
| mobile   | 是   | string | 64   | 手机                       |
| projGUID | 否   | string | 64   | 项目GUID，如果非空，则根据项目查客户和跟进|
| cardId   | 否   | string | 64   | 身份证                     |

-   **响应说明** 

| 参数               | 必须       | 类型      | 说明                         |
|--------------------|------------|-----------|------------------------------|
| exist              | 是         | int       | 客户是否存在（1：是；0：否） |
| identitys          | 存在时必须 | jsonArray | 客户身份列表<br/>20101 曾经业主<br/>20102 当前业主 <br/>20103 租客<br/>20201 会员<br/>20301 经纪人<br/>20302 置业顾问 <br/>20401 员工 <br/> 20402 房产员工 <br/> 20501 供应商<br/> 20502 企业客户 |
| list               | 存在时必须 | array     | 跟进记录                     |
| list/followTime    | 是         | string    | 跟进时间                     |
| list/followType    | 是         | int       | 跟进类别<br/>1=预约 <br/>2=来电 <br/>3=到访 <br/> 4=认筹<br/>5=认购 <br/>6=签约<br/>7=回款<br/>8=其它|
| list/followContent | 是         | string    | 跟进内容                     |

## 4.4. 跟进类接口

###4.4.1. P-FR-01客户推荐上报（agent_recommend）

-   **接口说明**

1.由于没有案场，经纪人平台推荐的客户直接上报明源 
 a)上报明源时，新老客户的myGUID处理规则：优先取有身份证的，其次多个取时间最近的
 b)经纪人推荐的是顶级项目，上报明源要分期项目，选定规则是：根据顶级项目查询分期项目列表，取第一条分期项目上报客户，客户在明源有跟进或交易后，下发客户状态通知时带上顶级项目。
2.客户主档上报数据中心（数据服务接口：cst_query_and_insert） 
3.推荐信息上报数据中心（数据服务接口：s_create_recommend）

-   **请求说明** 

| 参数           | 必须 | 类型   | 说明                                                   |
|----------------|------|--------|--------------------------------------------------------|
| agentGUID      | 是   | string | 经纪人ID                                               |
| agentName	     | 是   | String | 经纪人姓名			|
| agentMobile 	 | 是   | string | 经纪人电话 	|
| cstName        | 是   | string | 客户姓名                                               |
| cstMobile      | 是   | string | 客户手机号码                                           |
| cstMobile2     | 否   | string | 备用手机号码,备用号码只作为查看地和联系使用，不参与任何业务逻辑处理  |
| projGUID       | 是   | string | 项目code                                               |
| productType    | 是   | string | 产品品类                                               |
| proxyCompanyId | 否   | string | 代理公司ID                                             |
| consultantId   | 否   | string | 置业顾问ID                                             |
| remark         | 是   | string | 备注                                                   |
| appointTime    | 是   | string | 预约上门时间                                           |
| gender         | 是   | int    | 客户性别：1男 2 女                                               |
| prizeRule      | 否   | String | 对结佣规则的描述                                       |
| isAccompany    | 是   | int    | 是否陪同上门（1是0否）                                 |
| recommendTime  | 是   | string | 上报时间，*yyyy-MM-dd HH:mm&#58;ss*|
| expireTime     | 否   | string | 过期时间，*yyyy-MM-dd HH:mm&#58;ss*   |
| enable         | 是   | int    | <font color="red">推荐状态<br/> 固定为1：有效</font>|

-   **响应说明** 

| 参数    | 必须 | 类型   | 长度 | 说明                             |
|---------|------|--------|------|----------------------------------|
| cstGUID | 否   | string | 64   | 成功后返回客户在数据中心的唯一ID |
| leadID  | 否   | string | 64   | 成功后返回对应推荐线索的ID       |

### 4.4.2. P-FR-02推荐状态更新(agent\_recommend\_update)

-   **接口说明**

    经纪人平台对推荐状态人工干预后，上报数据中心

-   **请求说明**  

| 参数       | 是否必须 | 类型   | 说明                          |
|------------|----------|--------|-------------------------------|
| leadID     | 是       | string | 线索ID                        |
| status     | 是       | int    | 0=无效<br/>1=有效                         |
| remark     | 是       | string | 状态原因                      |
| expireTime | 否       | string | 过期时间，*yyyy-MM-dd HH:mm&#58;ss* |

-   **响应说明**

| 参数 | 必须 | 类型 | 说明 |
|------|------|------|------|
|      |      |      |      |

### 4.4.3. P-FR-09客户预约上报(sale\_appoint)（作废）

-   **接口说明**

    预约看房上报数据中心；

-   **请求说明** 

| 参数        | 必须 | 类型   | 长度 | 说明         |
|-------------|------|--------|------|--------------|
| mobile      | 是   | string | 64   | 客户手机     |
| cstName     | 是   | string | 64   | 客户姓名     |
| appointTime | 是   | string | 64   | 预约看房时间 |
| projGUID    | 是   | string | 64   | 项目编号     |
| userGUID    | 否   | string | 64   | 置业顾问ID   |
| appintType  | 是   | int    | 10   | 预约类型<br/>1=主动<br/>2=被动预约 |
| remark      | 是   | string | 64   | 备注说明     |

-   **响应说明** 

| 参数        | 必须 | 类型   | 说明               |
|-------------|------|--------|--------------------|
| appointCode | 否   | string | 预约号，成功时返回 |

## 4.5. 通知推送类接口

### 4.5.1. N-CU-01客户状态通知（notify\_cst\_status）

+ **接口说明**
客户状态通知是涉及跟进记录产生或修改的时候产生，不管是交易前跟进还是交易后跟进都会产生。 
> 消息类型：dc.mq.cst.status

+ **数据流**
通知消息由数据服务模块产生，由service-message下发。

-   **请求说明** 

| 参数              | 必须           | 类型       | 长度   | 说明                                                                                              |
|-------------------|----------------|------------|--------|---------------------------------------------------------------------------------------------------|
| cstGUID           | 是             | string     | 64     | 客户ID                                                                                            |
| projGUID          | 是             | string     | 64     | 项目编号 （分期项目）                                                                                         |
| oriProjGUID       | 是             | string     | 64     | 原始项目编号，即经纪人给的原始项目（顶级项目） |
| followTime        | 是             | string     | 64     | 跟进时间:*yyyy-MM-dd HH:mm&#58;ss*      |
| followType        | 是             | int        | 10     | 1=预约 <br/> 2=来电<br/>3=到访<br/>4=认筹<br/> 5=认购<br/> 6=签约 <br/> 7=回款 <br/> 8=其它 <br/> 09=转机会<br/>  21=入伙<br/> 220=退筹 <br/>230=认购退房 <br/> 231=认购作废<br/> 232=认购变更 <br/> 233=认购换房<br/> 234=认购变价 <br/> 235=认购变更付款方案<br/> 240=签约退房 <br/>241=签约作废 <br/> 242=签约变更 <br/> 243=签约换房<br/>244=签约变价<br/>245=签约变更付款方案<br/>30=已交楼<br/>31=产权出证<br/> 32=已入伙 <br/>33=跟踪<br/>34=投诉  |
| followContent     | 否             | string     | 64     | 跟进内容                                                                                          |
| nextFollowTime    | 否             | string     | 64     | 下次跟进时间 *yyyy-MM-dd HH:mm&#58;ss* |
| nextFollowContent | 否             | string     | 64     | 下次跟进内容                                                                                      |
| money             | 否             | double     | 64     | 认筹、认购或签约等成交类的金额                                                                    |
| room              | 否，存在时必须 | object     |        | 认购、签约等成交时的房产                                                                          |
| room/roomGUID     | 是             | string     | 64     | 房间GUID                                                                                          |
| room/huxing       | 是             | string     | 64     | 户型                                                                                              |
| room/roomNo       | 是             | string     | 64     | 房号                                                                                              |
| room/houseType    | 是             | string     | 64     | 产品类型(业态代码)                                                                                |
| followRecordID    | 是             | string     | 64     | 唯一编号                                                                                          |
| sourceApp         | 是             | string     | 64     | 系统来源                                                                                          |
| activitySource    | **否**         | **string** | **64** | 媒体活动                                                                                          |
| remark            | 否             | string     | 64     | 备注                                                                                              |
| userGUID          | 否             | string     | 64     | 置业顾问                                                                                          |
| rate              | 否             | int        | 10     | 成交几率 1=A级,2=B级,3=C级,4=D级 |

-   **响应说明** 

| 参数 | 必须 | 类型 | 说明 |
|------|------|------|------|
|||||

### 4.5.2. N-CU-02客户资料变更通知(notify\_cst\_update)

-   **接口说明**

    客户资料变更包括新增和修改，如果是更新则只有当基本信息发生更新时才通知，即姓名、性别、生日、手机（包括家话电话和办公电话）、客户类型发生更新时才通知，通知内容不含证件类型和证件号 
> 消息类型：dc.mq.cst.update

-   **请求说明** 

| 参数              | 必须   | 类型         | 长度   | 说明                                                  |
|-------------------|--------|--------------|--------|-------------------------------------------------------|
| cstGUID           | 是     | string       | 64     | 客户ID                                                |
| cstName           | 是     | string       | 64     | 客户姓名                                              |
| gender            | 是     | int          | 10     | 性别：1=男，2=女，3=未知                              |
| birthDate         | 否     | string       | 64     | 生日：*yyyy-MM-dd HH:mm&#58;ss*|
| cstType           | 是     | int          | 10     | 客户类型：1=个人，2=公司                              |
| mobileTel         | 否     | string       | 64     | 手机                                                  |
| officeTel         | 否     | string       | 64     | 办公电话                                              |
| homeTel           | 否     | string       | 64     | 家庭电话                                              |
| sourceApp         | 是     | string       | 64     | 系统来源                                              |
| cardType          | 否 | int      | 10 | **证件类型                                          |
| cardID            | 否     | varchar(128) | 128    | 证件号码                                              |
| userGUID          | 否     | String       | 64 | 业务员（新客户是对应登记人、老客户是 对应修改人） |
| address           | 否     | string       | 64 | 地址                                              |
| backupTel1        | 否     | string       | 64 | 备用号码1                                             |
| backupTel2        | 否     | string       | 64 | 备用号码2                                             |
| backupTel3        | 否     | string       | 64 | 备用号码3                                             |
| backupTel4        | 否     | string       | 64 | 备用号码4                                             |
| corporationPerson | 否     | string       | 64 | 企业法人                                              |
| corporationMobile | 否     | string       | 64 | 法人联系电话                                          |
| firstContact      | 否     | string       | 64 | 首先联系人                                            |
| corporationScale  | 否     | string       | 64 | 企业规模                                              |

-   **响应说明** 

| 参数 | 必须 | 类型 | 说明 |
|------|------|------|------|
|||||

### 4.5.3. N-CU-03客户资料合并通知(notify\_cst\_merge)

-   **接口说明**

    客户主档在数据中心发生合并时，通知到各应用做相应变更 
> 消息类型：dc.mq.cst.merge

-   **请求说明** 

| 参数      | 必须   | 类型       | 长度   | 说明                              |
|-----------|--------|------------|--------|-----------------------------------|
| retainCst | 是 | string | 64 | 合并时保留继续使用的客户ID    |
| dropedCst | 是     | string     | 64     | 合并时丢弃不再使用的客户ID        |
| mergeTime | 是 | string | 64 | 合并时间：*yyyy-MM-dd HH:mm&#58;ss*|

-   **响应说明**  

| 参数 | 必须 | 类型 | 说明 |
|------|------|------|------|
|||||

### 4.5.4. N-FR-04分配置业顾问通知(notify\_sale\_opp\_assign)

-   **接口说明**

    使用场景：案场分配置业顾问，通知到同享会 
> 消息类型：dc.mq.opp.assign

-   **请求说明** 

| 参数       | 必须   | 类型   | 长度   | 说明                          |
|------------|--------|--------|--------|-------------------------------|
| cstGUID    | 是 | string | 64 | 客户ID                    |
| oppGUID    | 是     | string | 64     | 机会                          |
| leadGUID   | 否     | string | 64     | 线索编号                      |
| projGUID   | 是 | string | 64 | 项目编号                  |
| userGUID   | 是     | string | 64     | 分配的 置业顾问编号           |
| userType   | 是 | int    | 10 | 分配的 置业顾问类型       |
| modifyBy   | 是 | String | 64 | 修改人(置业顾问编号)      |
| assignType | 是     | int    | 10     | 分配方式<br/>1=自动轮巡 <br/>2=手动分配 <br/>3=自主抢客 <br/> 4=转交  |
| remark     | 否 | string | 64 | 备注说明                  |
| assignTime | 是 | string | 64     | 分配时间，*yyyy-MM-dd HH:mm&#58;ss* |
| sourceApp  | 是     | string | 64     | 系统来源                      |

-   **响应说明** 

| 参数 | 必须 | 类型 | 说明 |
|------|------|------|------|
|||||

# 5. 错误码定义

## 5.1. 系统错误码

| 错误码 | 描述                 |
|--------|----------------------|
| 0      | 成功                 |
| -1     | 未知错误             |
| 1001   | 缺少必须参数\[%s\]   |
| 1002   | 参数类型错误\[%s\]   |
| 1003   | 不支持的请求方式     |
| 1004   | 请求数据格式错误     |
| 1005   | 系统处理失败         |
| 1006   | 请求数据过大         |
| 1007   | 请求数据缺失         |
| 1008   | 不支持的接口请求     |
| 1009   | 接入验证失败         |
| 1010   | 接口权限验证失败     |
| 1011   | 未知业务应用         |
| 1012   | 查询的记录不存在     |
| 1013   | 消息序列号重复       |
| 1014   | 响应返回数据格式错误 |
| 1015   | 消息序列号格式错误   |
| 1016   | 没有操作该项目的权限 |
| 1017   | 不支持的消息协议版本 |
| 1018   | 通信消息被非法篡改   |
| 1019   | 不支持的数据服务接口 |
| 1020   | 不支持的content-type |
| 1021   | 调用数据服务接口失败 |


## 5.2. 业务错误码

业务错误码包含系统外的所有错误码，其中客户信息相关的错误码为2xxx段，基础数据错误码为4xxx段，推送通知类6xxx段，各业务可通用错误码为9xxx段。

### 5.2.1 客户类错误码

| 错误码 | 描述                               |
|--------|------------------------------------|
| 2001   | 客户不存在                         |
| 2002   | 客户已经存在                       |
| 2003   | 手机号码已被占用                   |
| 2004   | 证件号码已被占用                   |
| 2005   | 加锁失败\[该客户已被加锁\]         |
| 2006   | 解锁失败                           |
| 2007   | 修改失败\[该客户存在认购或者签约\] |

### 5.2.2 销售类错误码

| 错误码 | 描述         |
|--------|--------------|
| 3001   | 预约不存在   |
| 3002   | 线索不存在   |
| 3003   | 机会不存在   |
| 3004   | 机会已经存在 |

### 5.2.3 基础数据类错误码

| 错误码 | 描述             |
|--------|------------------|
| 4001   | 项目不存在       |
| 4002   | 置业顾问不存在   |
| 4003   | 置业顾问已经存在 |
| 4004   | 代理公司已经存在 |
| 4005   | 代理公司不存在   |
| 4006   | 指定项目没有开通 |
| 4007   | 经纪人不存在     |
| 4008   | 经纪人已经存在   |
| 4009   | 经纪人身份不明   |

### 5.2.4 推送通知类错误码

| 错误码 | 描述         |
|--------|--------------|
| 6001   | 消息推送失败 |
|        |              |

### 5.2.5 业务通用错误码

| 错误码 | 描述           |
|--------|----------------|
| 9001   | 非法身份证号码 |
| 9002   | 非法手机号码   |


